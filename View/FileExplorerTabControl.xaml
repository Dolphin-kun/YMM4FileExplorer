<UserControl x:Class="YMM4FileExplorer.FileExplorerTabControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:YMM4FileExplorer"
             xmlns:theme="clr-namespace:YukkuriMovieMaker.Theme;assembly=YukkuriMovieMaker.Plugin"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <Style TargetType="{x:Type TabControl}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabControl}">
                        <Grid KeyboardNavigation.TabNavigation="Local">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <ScrollViewer Grid.Row="0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" CanContentScroll="False">
                                <StackPanel Orientation="Horizontal">
                                    <TabPanel IsItemsHost="True" Background="Transparent" KeyboardNavigation.TabIndex="1" HorizontalAlignment="Left" />
                                    <Button Content="＋" Click="AddTab_Click" VerticalAlignment="Center" Margin="2,0,0,1" Padding="8,0" FontSize="14" BorderThickness="0" Background="Transparent" />
                                </StackPanel>
                            </ScrollViewer>
                            <Border Grid.Row="1" BorderBrush="{DynamicResource {x:Static theme:YMM4Colors.IconBorderBrushKey}}" BorderThickness="0,1,0,0">
                                <ContentPresenter x:Name="PART_SelectedContentHost" ContentSource="SelectedContent"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <TabControl Name="MainTabControl">

            <TabControl.ItemContainerStyle>
                <Style TargetType="{x:Type TabItem}">
                    <Setter Property="MinWidth" Value="120"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type TabItem}">
                                <Border x:Name="TabBorder" 
                                        BorderBrush="{DynamicResource {x:Static theme:YMM4Colors.IconBrushKey}}" 
                                        BorderThickness="0.5,0.5,0.5,0" 
                                        Margin="0,0,2,0"
                                        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
                                    <ContentPresenter x:Name="ContentSite"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Stretch"
                                                      ContentSource="Header"
                                                      ContentTemplate="{TemplateBinding HeaderTemplate}"
                                                      Margin="4,2"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" />
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
                                        <Setter Property="Margin" Value="0,0,2,-1"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.ItemContainerStyle>
            <TabControl.Resources>
                <DataTemplate x:Key="TabHeaderTemplate">
                    <DockPanel>
                        <Button Content="X" DockPanel.Dock="Right"
                                Click="CloseTab_Click" 
                                FontFamily="Meiryo" FontSize="10" Padding="2,2,2,0" Margin="2,0,-2,0" 
                                BorderThickness="0" Background="Transparent" VerticalAlignment="Center"/>
                        <Button Content="︙" DockPanel.Dock="Left"
                                FontFamily="Meiryo UI" Margin="-3,0,0,0" 
                                BorderThickness="0" Background="Transparent" VerticalAlignment="Center"
                                Click="MenuButton_Click">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="名前の変更" Click="RenameTab_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                        <TextBlock Text="{Binding Header}"
                                   Foreground="{DynamicResource {x:Static theme:YMM4Colors.IconBrushKey}}"
                                   VerticalAlignment="Center"
                                   Padding="5,0"
                                   TextTrimming="CharacterEllipsis"/>
                    </DockPanel>
                </DataTemplate>
            </TabControl.Resources>

            <TabControl.ContentTemplate>
                <DataTemplate>
                    <ContentPresenter Content="{Binding Content}"/>
                </DataTemplate>
            </TabControl.ContentTemplate>

            <TabControl.ItemTemplate>
                <StaticResource ResourceKey="TabHeaderTemplate"/>
            </TabControl.ItemTemplate>

        </TabControl>
    </Grid>
</UserControl>